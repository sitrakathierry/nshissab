 {% extends 'menu/index.html.twig' %}

{% block title %}{{titlePage}}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{asset('tools/personnal/systeme/' ~ filename ~ '/css/' ~ filename ~ '.css')}}">
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{asset('tools/personnal/systeme/' ~ filename ~ '/js/' ~ filename ~ '.js')}}" ></script>
{% endblock %}
{% block body %}
<div class="barre_top rounded shadow mb-5">
    <div class="w-100 border-bottom pt-2 px-3">
        <h4 class="text-uppercase entete_page text-black">{{titlePage}}</h4>
    </div>
    <div class="container-fluid px-3 pt-2">
        <form id="formFacture">
        <div class="d-flex flex-row align-items-center justify-content-left">
            {% for type in types %}
                <button type="button" data-mode="{{type.modePaiement}}" data-text="{{type.nom|upper}}" data-class="btn-primary" data-target="#fact_type" value="{{type.id}}" class="btn fact_btn_type btn-sm btn-outline-primary mx-2">{{type.nom|upper}}</button>
            {% endfor %}
            <input type="hidden" class="fact_type" id="fact_type" name="fact_type" >
        </div>
        <div class="d-flex flex-row align-items-center fact_content_paiement justify-content-left mt-3">
            {% for paiement in paiements %}
                <button type="button" data-numcaption="{{paiement.numCaption}}" disabled="true" data-text="{{paiement.nom|upper}}" data-class="btn-info" data-target="#fact_paiement" value="{{paiement.id}}" class="btn fact_btn_paiement {{paiement.reference}} btn-sm btn-outline-info mx-2">{{paiement.nom|upper}}</button>
            {% endfor %}
            <input type="hidden" class="fact_paiement" id="fact_paiement" name="fact_paiement" >
        </div>
        <div class="row mx-1 mt-3 fact_info_supp">
            <div class="col-md-3">
                <label for="fact_client" class="font-weight-bold text-uppercase">Client*</label>
                <select name="fact_client" class="custom-select chosen_select fact_client custom-select-sm" id="fact_client">
                    <option value=""></option>
                    {% for client in clients %}
                        <option value="{{client.id}}">{{client.client.nom|upper}}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label for="ajout_client" class="font-weight-bold text-uppercase">&nbsp;</label>
                <button type="button" class="btn btn-sm btn-primary btn-block ajout_client" id="ajout_client"><i class="fa fa-plus-circle"></i></button>
            </div>
            <div class="col-md-3">
                <label for="fact_num" class="font-weight-bold fact_num_caption text-uppercase">Numéro ...</label>
                <input type="text" disabled="true" class="form-control fact_num" oninput="this.value = this.value.toUpperCase();" id="fact_num" name="fact_num">
            </div>
        </div>
        <div class="table-responsive w-50 px-2 mt-3">
            <table class="table font-smaller fact_table_indice table-sm">
                <thead class="thead-dark">
                    <tr class="elem_title_histo">
                        <th class="bg-dark text-white">Type</th>
                        <th class="bg-dark text-white">Paiement</th>
                        <th class="bg-dark text-white">Client</th>
                        {# <th class="bg-dark text-white">Numéro</th> #}
                    </tr>
                </thead>
                <tbody>
                    <tr class="elem_table_histo">
                        <td class="fact_table_type"></td>
                        <td class="fact_table_paiement"></td>
                        <td class="fact_table_client"></td>
                        {# <td class="fact_table_numero"></td> #}
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="w-100 px-2">
            <label for="nom" class="mt-2 font-weight-bold text-uppercase">Description</label>
            <textarea name="facture_editor" class="form-control facture_editor" id="" cols="10" rows="5"></textarea>
        </div>
        <div class="d-flex barre_dashed flex-row align-items-center justify-content-center p-3 mt-3">
            {% for modele in modeles %}
                <button type="button" data-text="{{modele.nom|upper}}" data-class="btn-warning" data-target="#fact_modele" value="{{modele.id}}" class="btn fact_btn_modele btn-sm btn-outline-warning mx-2">{{modele.nom|upper}}</button>
            {% endfor %}
            <input type="hidden" class="fact_modele" id="fact_modele" name="fact_modele" >
        </div>
        <div class="barre_dashed p-3">
            <div class="container-fluid">
                <h5 class="title_form text-black text-uppercase">Insertion modèle <span class="fact_title_modele"></span></h5>
                <div class="row">
                    <div class="col-md-3">
                        <label for="fact_mod_prod_type" class="font-weight-bold">Type</label>
                        <select class="custom-select custom-select-sm chosen_select fact_mod_prod_type" name="fact_mod_prod_type" id="fact_mod_prod_type" >
                            <option value="Produit">Produit</option> 
                            <option value="autre">Autre</option> 
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="fact_mod_prod_designation" class="font-weight-bold">Designation</label>
                        <div class="w-100 content_fact_designation">
                            <select class="custom-select custom-select-sm chosen_select fact_mod_prod_designation" name="fact_mod_prod_designation" id="fact_mod_prod_designation" >
                                <option value=""></option>
                                {% for stockGeneral in stockGenerales %}
                                    <option value="{{stockGeneral.id}}">{{stockGeneral.codeProduit}} | {{stockGeneral.nom}} | stock : {{stockGeneral.stock}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <input type="hidden" id="fact_text_designation">
                    </div>
                    <div class="col-md-3">
                        <label for="fact_mod_prod_prix" class="font-weight-bold">Prix Unitaire HT</label>
                        <div class="content_fact_prix w-100">
                            <select class="custom-select custom-select-sm chosen_select fact_mod_prod_prix" name="fact_mod_prod_prix" id="fact_mod_prod_prix" >
                                <option value=""></option> 
                            </select>
                        </div>
                        <input type="hidden" id="fact_text_prix">
                    </div>
                    <div class="col-md-2">
                        <label for="fact_mod_prod_qte" class="font-weight-bold">Quantité</label>
                        <input type="number" name="fact_mod_prod_qte" class="form-control fact_mod_prod_qte" id="fact_mod_prod_qte" placeholder=". . .">
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-2">
                        <label for="fact_mod_prod_tva_val" class="font-weight-bold">TVA(%)</label>
                        <input type="number" name="fact_mod_prod_tva_val" class="form-control fact_mod_prod_tva_val" id="fact_mod_prod_tva_val" placeholder=". . .">
                    </div>
                    <div class="col-md-2">
                        <label for="fact_mod_prod_type_remise" class="font-weight-bold">Type Remise</label>
                        <select class="custom-select custom-select-sm chosen_select fact_mod_prod_type_remise" name="fact_mod_prod_type_remise" id="fact_mod_prod_type_remise" >
                            <option value=""></option> 
                            <option value="1">%</option> 
                            <option value="2">Montant</option> 
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="fact_mod_prod_remise" class="font-weight-bold">Remise</label>
                        <input type="number" name="fact_mod_prod_remise" class="form-control fact_mod_prod_remise" id="fact_mod_prod_remise" placeholder=". . .">
                    </div>
                    <div class="col-md-2">
                        <label for="fact_mod_prod_remise" class="font-weight-bold">&nbsp;</label>
                        <button type="button" class="btn btn-success btn-block btn-sm px-4 ajout_fact_element" ><i class="fa fa-plus-circle"></i>&nbsp;AJOUTER</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="barre_dashed w-100 p-3">
            <div class="table-responsive">
            <table class="table table-sm table-bordered table-hover">
                <thead class="thead-light">
                    <tr>
                        <th>Type</th>
                        <th>Designation</th>
                        <th class="fact_title_qte">Qte</th>
                        <th>Prix Unitaire HT</th>
                        <th>Montant TVA</th>
                        <th>Type Remise</th>
                        <th>Valeur Remise</th>
                        <th>Montant Total</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody class="elem_facture_produit">
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="7">Total HT</th>
                        <th class="bg-light"><span id="fact_total_fixe"></span></th>
                        <td class="bg-light"></td>
                    </tr>
                    <tr>
                        <th colspan="7">Remise</th>
                        <td>
                            <div class="container-fluid" style="width:325px ;">
                                <div class="row">
                                    <div class="col-md-5">
                                        <select class="custom-select custom-select-sm chosen_select" name="fact_type_remise_prod_general" id="fact_type_remise_prod_general" >
                                            <option value=""></option> 
                                            <option value="1">%</option> 
                                            <option value="2">Montant</option> 
                                        </select>
                                    </div>
                                    <div class="col-md-7">
                                        <input type="number" class="form-control" name="fact_remise_prod_general" id="fact_remise_prod_general">
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td></td>
                    </tr>
                    <tr>
                        <th colspan="7">Montant après déduction</th>
                        <th class="bg-light"><span id="fact_total_apres_deduction"></span></th>
                        <td class="bg-light"></td>
                    </tr>
                    <tr>
                        <th colspan="7">Total TVA</th>
                        <th class="align-middle bg-light">
                            <span id="fact_total_tva"></span>
                            <input type="hidden" class="fact_enr_total_tva" name="fact_enr_total_tva">   
                        </th>
                        <td></td>
                    </tr>
                    <tr>
                        <th colspan="7" class="fact_caption_total_general">Total ...</th>
                        <th class="bg-primary text-white">
                        <span id="fact_total_general"></span>
                        <input type="hidden" class="fact_enr_total_general" name="fact_enr_total_general">
                        </th>
                        <td class="bg-primary"></td>
                    </tr>
                    <tr>
                        <th colspan="7">Montant en <span id="fact_lettre_devise">(lettre)</span></th>
                        <th class="bg-light"><span id="fact_montant_devise"></span></th>
                        <td class="bg-light"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <div class="row">
            <div class="col-md-2">
                <label for="fact_devise" class="font-weight-bold text-uppercase">Montant en</label>
                <select name="fact_devise" class="custom-select chosen_select fact_devise custom-select-sm" id="fact_devise">
                    <option value=""></option>
                    {% for devise in devises %}
                        <option value="{{devise.id}}" base="{{devise.montantBase}}">{{devise.symbole}} | {{devise.lettre}}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-10">
                <label for="" class="font-weight-bold text-uppercase">&nbsp;</label>
                <div class="w-100">
                    Arrêté à la somme de <span id="fact_somme_lettre" class="font-weight-bold text-uppercase">Zéro Francs Comorien</span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-7"></div>
            <div class="col-md-5"> 
                <label for="nom" class="mt-1 font-weight-bold text-uppercase">à,</label>
                <div class="input-group mb-2">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1"><i class="fa fa-location"></i></span>
                    </div>
                    <input type="text" class="form-control fact_lieu" name="fact_lieu" value="Moroni" placeholder=". . ." aria-label="Date Facture" id="fact_lieu">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-7"></div>
            <div class="col-md-5"> 
                <label for="nom" class="mt-1 font-weight-bold">Le,</label>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="basic-addon1"><i class="fa fa-calendar"></i></span>
                    </div>
                    <input type="text" class="form-control fact_date" name="fact_date" value="{{ 'now'|date('d/m/Y') }}" placeholder=". . ." aria-label="Date Facture" id="fact_date">
                </div>
            </div>
        </div>
        </div>
        {% if with_foot %}
            <div class="foot_action p-3 mt-4 text-right w-100 barre_dashed">
                <button type="button" onclick="location.reload()" class="btn btn-sm effacerTout btn-secondary text-white"><i class="fa fa-close"></i>&nbsp;Annuler</button>
                <button type="submit" class="btn btn-sm ml-3 enregistre_create_facture btn-perso-one"><i class="fa fa-save"></i>&nbsp;Enregistrer</button>
            </div>
        {% endif %} 
        </form>
    </div>
</div>
{% endblock %}
